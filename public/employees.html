<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ - LenconDB</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="projects.html" class="header__logo">LenconDB</a>
    
    <nav class="header__nav">
      <a href="projects.html" class="header__nav-link">–ü—Ä–æ–µ–∫—Ç—ã</a>
      <a href="employees.html" class="header__nav-link header__nav-link--active">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
      <a href="companies.html" class="header__nav-link">–ö–æ–º–ø–∞–Ω–∏–∏</a>
      <a href="workload.html" class="header__nav-link">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</a>
    </nav>
    
    <div class="header__user">
      <div class="header__user-info">
        <div class="header__user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="header__user-role" id="userRole">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <div class="header__user-avatar" id="userAvatar">?</div>
      <button class="button button--secondary button--small" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="page-header">
      <div class="container">
        <h1 class="page-header__title">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>
        <p class="page-header__subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö —Ä–æ–ª—è–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</p>
      </div>
    </div>

    <div class="container">
      <!-- Filters and Search -->
      <div class="card">
        <div class="filters">
          <div class="filters__group">
            <label class="filters__label" for="roleFilter">–†–æ–ª—å:</label>
            <select id="roleFilter" class="form__select filters__select">
              <option value="all">–í—Å–µ</option>
              <option value="Admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
              <option value="Manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
              <option value="Employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
              <option value="Customer">–ó–∞–∫–∞–∑—á–∏–∫</option>
            </select>
          </div>
          
          <div class="filters__group">
            <label class="filters__label" for="companyFilter">–ö–æ–º–ø–∞–Ω–∏—è:</label>
            <select id="companyFilter" class="form__select filters__select">
              <option value="all">–í—Å–µ</option>
            </select>
          </div>

          <div class="search-input">
            <input 
              type="text" 
              id="searchInput" 
              class="form__input search-input__field" 
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, email..."
            >
            <span class="search-input__icon">üîç</span>
          </div>

          <button class="button button--primary" id="newEmployeeButton" onclick="showNewEmployeeModal()">
            + –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="totalEmployees">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–í—Å–µ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--success); margin-bottom: 0.5rem;" id="activeEmployees">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--warning); margin-bottom: 0.5rem;" id="managersCount">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ú–µ–Ω–µ–¥–∂–µ—Ä–æ–≤</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--secondary); margin-bottom: 0.5rem;" id="employeesCount">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤</div>
          </div>
        </div>
      </div>

      <!-- Employees Table -->
      <div class="table-container">
        <table class="table">
          <thead class="table__head">
            <tr>
              <th class="table__header table__header--sortable" data-sort="firstName">–§–ò–û</th>
              <th class="table__header table__header--sortable" data-sort="email">Email</th>
              <th class="table__header table__header--sortable" data-sort="phone">–¢–µ–ª–µ—Ñ–æ–Ω</th>
              <th class="table__header table__header--sortable" data-sort="role">–†–æ–ª—å</th>
              <th class="table__header table__header--sortable" data-sort="companyName">–ö–æ–º–ø–∞–Ω–∏—è</th>
              <th class="table__header table__header--sortable" data-sort="dateBirth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</th>
              <th class="table__header table__header--sortable" data-sort="createdAt">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
              <th class="table__header">–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody class="table__body" id="employeesTableBody">
            <!-- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
          </tbody>
        </table>

        <!-- Loading State -->
        <div id="loadingState" class="text-center" style="padding: 2rem;">
          <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...</p>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center" style="padding: 2rem; display: none;">
          <p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
          <button class="button button--primary" onclick="showNewEmployeeModal()">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
        </div>
      </div>

      <!-- Pagination -->
      <div class="pagination">
        <div class="pagination__info">
          –ü–æ–∫–∞–∑–∞–Ω–æ <span id="itemsShown">0</span> –∏–∑ <span id="totalItems">0</span> —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        </div>
        <div class="pagination__controls">
          <button class="pagination__button" id="prevButton" onclick="goToPage(currentPage - 1)">‚Üê –ù–∞–∑–∞–¥</button>
          <div id="pageNumbers"></div>
          <button class="pagination__button" id="nextButton" onclick="goToPage(currentPage + 1)">–î–∞–ª–µ–µ ‚Üí</button>
        </div>
      </div>
    </div>
  </main>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal">
    <div class="modal">
      <div class="modal__header">
        <h3 class="modal__title">–ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h3>
        <button class="modal__close" onclick="hideNewEmployeeModal()">√ó</button>
      </div>
      <div class="modal__content">
        <form class="form" id="newEmployeeForm">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form__group">
              <label for="firstName" class="form__label form__label--required">–ò–º—è</label>
              <input type="text" id="firstName" class="form__input" placeholder="–ò–≤–∞–Ω" required>
            </div>
            
            <div class="form__group">
              <label for="lastName" class="form__label form__label--required">–§–∞–º–∏–ª–∏—è</label>
              <input type="text" id="lastName" class="form__input" placeholder="–ò–≤–∞–Ω–æ–≤" required>
            </div>
          </div>
          
          <div class="form__group">
            <label for="email" class="form__label form__label--required">Email</label>
            <input type="email" id="email" class="form__input" placeholder="ivan@company.com" required>
            <div class="form__error" id="emailError" style="display: none;"></div>
          </div>
          
          <div class="form__group">
            <label for="phone" class="form__label form__label--required">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="phone" class="form__input" placeholder="+7 (999) 123-45-67" required>
          </div>
          
          <div class="form__group">
            <label for="dateBirth" class="form__label form__label--required">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="dateBirth" class="form__input" required>
          </div>
          
          <div class="form__group">
            <label for="role" class="form__label form__label--required">–†–æ–ª—å</label>
            <select id="role" class="form__select" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
              <option value="Admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
              <option value="Manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
              <option value="Employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
              <option value="Customer">–ó–∞–∫–∞–∑—á–∏–∫</option>
            </select>
          </div>
          
          <div class="form__group">
            <label for="companyId" class="form__label form__label--required">–ö–æ–º–ø–∞–Ω–∏—è</label>
            <select id="companyId" class="form__select" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é</option>
            </select>
          </div>
          
          <div class="form__group">
            <label for="password" class="form__label form__label--required">–í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å</label>
            <input type="password" id="password" class="form__input" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" required minlength="6">
            <div class="form__help">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞</div>
          </div>

          <div class="form__group">
            <label for="telegramId" class="form__label">Telegram ID</label>
            <input type="number" id="telegramId" class="form__input" placeholder="123456789">
            <div class="form__help">–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram –±–æ—Ç–æ–º —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏</div>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="button button--secondary" onclick="hideNewEmployeeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="button button--primary" id="createEmployeeButton" onclick="createEmployee()">
          <span id="createButtonText">–°–æ–∑–¥–∞—Ç—å</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal">
    <div class="modal">
      <div class="modal__header">
        <h3 class="modal__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
        <button class="modal__close" onclick="hideEditEmployeeModal()">√ó</button>
      </div>
      <div class="modal__content">
        <form class="form" id="editEmployeeForm">
          <input type="hidden" id="editEmployeeId">
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form__group">
              <label for="editFirstName" class="form__label form__label--required">–ò–º—è</label>
              <input type="text" id="editFirstName" class="form__input" required>
            </div>
            
            <div class="form__group">
              <label for="editLastName" class="form__label form__label--required">–§–∞–º–∏–ª–∏—è</label>
              <input type="text" id="editLastName" class="form__input" required>
            </div>
          </div>
          
          <div class="form__group">
            <label for="editEmail" class="form__label form__label--required">Email</label>
            <input type="email" id="editEmail" class="form__input" required>
          </div>
          
          <div class="form__group">
            <label for="editPhone" class="form__label form__label--required">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="editPhone" class="form__input" required>
          </div>
          
          <div class="form__group">
            <label for="editDateBirth" class="form__label form__label--required">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input type="date" id="editDateBirth" class="form__input" required>
          </div>
          
          <div class="form__group">
            <label for="editRole" class="form__label form__label--required">–†–æ–ª—å</label>
            <select id="editRole" class="form__select" required>
              <option value="Admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
              <option value="Manager">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
              <option value="Employee">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
              <option value="Customer">–ó–∞–∫–∞–∑—á–∏–∫</option>
            </select>
          </div>
          
          <div class="form__group">
            <label for="editCompanyId" class="form__label form__label--required">–ö–æ–º–ø–∞–Ω–∏—è</label>
            <select id="editCompanyId" class="form__select" required>
            </select>
          </div>

          <div class="form__group">
            <label for="editTelegramId" class="form__label">Telegram ID</label>
            <input type="number" id="editTelegramId" class="form__input">
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="button button--secondary" onclick="hideEditEmployeeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="button button--primary" onclick="updateEmployee()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentUser = null;
    let employees = [];
    let filteredEmployees = [];
    let currentPage = 1;
    const itemsPerPage = 20;
    let sortBy = 'firstName';
    let sortOrder = 'asc';

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function checkAuth() {
      const user = localStorage.getItem('user');
      const accessToken = localStorage.getItem('accessToken');
      
      if (!user || !accessToken) {
        window.location.href = 'login.html';
        return;
      }
      
      currentUser = JSON.parse(user);
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
      if (currentUser.role === 'Employee') {
        window.location.href = 'projects.html';
        return;
      }
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      document.getElementById('userName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
      document.getElementById('userRole').textContent = getRoleText(currentUser.role);
      document.getElementById('userAvatar').textContent = `${currentUser.firstName[0]}${currentUser.lastName[0]}`;
      
      updateUIForRole();
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–æ–ª–∏
    function getRoleText(role) {
      const roles = {
        'Admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
        'Manager': '–ú–µ–Ω–µ–¥–∂–µ—Ä',
        'Employee': '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
        'Customer': '–ó–∞–∫–∞–∑—á–∏–∫'
      };
      return roles[role] || role;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    function updateUIForRole() {
      const newEmployeeButton = document.getElementById('newEmployeeButton');
      
      if (currentUser.role === 'Manager') {
        // –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
        newEmployeeButton.style.display = 'none';
      }
    }

    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    function logout() {
      localStorage.removeItem('user');
      localStorage.removeItem('accessToken');
      localStorage.removeItem('refreshToken');
      window.location.href = 'login.html';
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const demoEmployees = [
      {
        id: '1',
        email: 'admin@lencondb.com',
        firstName: '–ê–¥–º–∏–Ω',
        lastName: '–°–∏—Å—Ç–µ–º—ã',
        phone: '+7 (999) 111-11-11',
        dateBirth: '1985-03-15',
        role: 'Admin',
        companyId: '1',
        companyName: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        telegramId: null,
        createdAt: '2024-01-01'
      },
      {
        id: '2',
        email: 'manager@lencondb.com',
        firstName: '–ï–ª–µ–Ω–∞',
        lastName: '–ü–µ—Ç—Ä–æ–≤–∞',
        phone: '+7 (999) 222-22-22',
        dateBirth: '1978-07-22',
        role: 'Manager',
        companyId: '1',
        companyName: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        telegramId: 123456789,
        createdAt: '2024-01-01'
      },
      {
        id: '3',
        email: 'employee@lencondb.com',
        firstName: '–ò–≤–∞–Ω',
        lastName: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤',
        phone: '+7 (999) 333-33-33',
        dateBirth: '1992-11-08',
        role: 'Employee',
        companyId: '1',
        companyName: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        telegramId: 987654321,
        createdAt: '2024-01-05'
      },
      {
        id: '4',
        email: 'maria@lencondb.com',
        firstName: '–ú–∞—Ä–∏—è',
        lastName: '–ß–µ—Ä—Ç–µ–∂–Ω–∏–∫–æ–≤–∞',
        phone: '+7 (999) 444-44-44',
        dateBirth: '1988-05-12',
        role: 'Employee',
        companyId: '1',
        companyName: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        telegramId: null,
        createdAt: '2024-01-10'
      },
      {
        id: '5',
        email: 'petr@lencondb.com',
        firstName: '–ü–µ—Ç—Ä',
        lastName: '–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤—â–∏–∫',
        phone: '+7 (999) 555-55-55',
        dateBirth: '1990-09-25',
        role: 'Employee',
        companyId: '1',
        companyName: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        telegramId: 456789123,
        createdAt: '2024-01-15'
      },
      {
        id: '6',
        email: 'customer@company.com',
        firstName: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä',
        lastName: '–ó–∞–∫–∞–∑—á–∏–∫–æ–≤',
        phone: '+7 (999) 666-66-66',
        dateBirth: '1975-12-03',
        role: 'Customer',
        companyId: '2',
        companyName: '–û–û–û "–°—Ç—Ä–æ–π–ò–Ω–≤–µ—Å—Ç"',
        telegramId: null,
        createdAt: '2024-02-01'
      }
    ];

    const demoCompanies = [
      { id: '1', name: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ' },
      { id: '2', name: '–û–û–û "–°—Ç—Ä–æ–π–ò–Ω–≤–µ—Å—Ç"' },
      { id: '3', name: '–ê–û "–¢–æ—Ä–≥–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä—ã"' },
      { id: '4', name: '–ó–ê–û "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ü–ª—é—Å"' }
    ];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    function loadData() {
      employees = demoEmployees;
      applyFilters();
      loadCompaniesForFilters();
      loadCompaniesForModals();
      updateStatistics();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function loadCompaniesForFilters() {
      const companyFilter = document.getElementById('companyFilter');
      companyFilter.innerHTML = '<option value="all">–í—Å–µ</option>';
      
      demoCompanies.forEach(company => {
        const option = document.createElement('option');
        option.value = company.id;
        option.textContent = company.name;
        companyFilter.appendChild(option);
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    function loadCompaniesForModals() {
      const selects = [
        document.getElementById('companyId'),
        document.getElementById('editCompanyId')
      ];
      
      selects.forEach(select => {
        select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–∞–Ω–∏—é</option>';
        
        demoCompanies.forEach(company => {
          const option = document.createElement('option');
          option.value = company.id;
          option.textContent = company.name;
          select.appendChild(option);
        });
      });
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStatistics() {
      document.getElementById('totalEmployees').textContent = employees.length;
      document.getElementById('activeEmployees').textContent = employees.filter(e => e.role !== 'Customer').length;
      document.getElementById('managersCount').textContent = employees.filter(e => e.role === 'Manager').length;
      document.getElementById('employeesCount').textContent = employees.filter(e => e.role === 'Employee').length;
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function applyFilters() {
      const roleFilter = document.getElementById('roleFilter').value;
      const companyFilter = document.getElementById('companyFilter').value;
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();

      filteredEmployees = employees.filter(employee => {
        // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–æ–ª–∏
        if (roleFilter !== 'all' && employee.role !== roleFilter) return false;
        
        // –§–∏–ª—å—Ç—Ä –ø–æ –∫–æ–º–ø–∞–Ω–∏–∏
        if (companyFilter !== 'all' && employee.companyId !== companyFilter) return false;
        
        // –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏ email
        if (searchQuery) {
          const fullName = `${employee.firstName} ${employee.lastName}`.toLowerCase();
          const email = employee.email.toLowerCase();
          if (!fullName.includes(searchQuery) && !email.includes(searchQuery)) return false;
        }
        
        return true;
      });

      renderEmployees();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    function renderEmployees() {
      const tbody = document.getElementById('employeesTableBody');
      const loadingState = document.getElementById('loadingState');
      const emptyState = document.getElementById('emptyState');
      
      loadingState.style.display = 'none';
      
      if (filteredEmployees.length === 0) {
        tbody.innerHTML = '';
        emptyState.style.display = 'block';
        updatePagination(0);
        return;
      }
      
      emptyState.style.display = 'none';
      
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
      const sortedEmployees = [...filteredEmployees].sort((a, b) => {
        let valueA = a[sortBy];
        let valueB = b[sortBy];
        
        if (sortBy === 'firstName') {
          valueA = `${a.firstName} ${a.lastName}`;
          valueB = `${b.firstName} ${b.lastName}`;
        }
        
        if (typeof valueA === 'string') {
          valueA = valueA.toLowerCase();
          valueB = valueB.toLowerCase();
        }
        
        if (sortOrder === 'asc') {
          return valueA > valueB ? 1 : -1;
        } else {
          return valueA < valueB ? 1 : -1;
        }
      });

      // –ü–∞–≥–∏–Ω–∞—Ü–∏—è
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedEmployees = sortedEmployees.slice(startIndex, endIndex);

      tbody.innerHTML = paginatedEmployees.map(employee => `
        <tr class="table__row">
          <td class="table__cell">
            <div style="display: flex; align-items: center; gap: 0.75rem;">
              <div class="header__user-avatar" style="width: 2rem; height: 2rem; font-size: 0.75rem;">
                ${employee.firstName[0]}${employee.lastName[0]}
              </div>
              <div>
                <div style="font-weight: 500;">${employee.firstName} ${employee.lastName}</div>
                ${employee.telegramId ? 
                  '<div style="font-size: 0.75rem; color: var(--success);">üì± Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω</div>' : 
                  '<div style="font-size: 0.75rem; color: var(--text-secondary);">üì± Telegram –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω</div>'
                }
              </div>
            </div>
          </td>
          <td class="table__cell">${employee.email}</td>
          <td class="table__cell">${formatPhone(employee.phone)}</td>
          <td class="table__cell">
            <span class="status-badge ${getRoleBadgeClass(employee.role)}">
              ${getRoleText(employee.role)}
            </span>
          </td>
          <td class="table__cell">${employee.companyName}</td>
          <td class="table__cell">${formatDate(employee.dateBirth)}</td>
          <td class="table__cell">${formatDate(employee.createdAt)}</td>
          <td class="table__cell table__cell--actions">
            <div class="table__actions">
              <button class="button button--small button--secondary" onclick="showEditEmployeeModal('${employee.id}')">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
              </button>
              ${currentUser.role === 'Admin' && employee.id !== currentUser.id ? 
                `<button class="button button--small button--danger" onclick="deleteEmployee('${employee.id}')">
                  –£–¥–∞–ª–∏—Ç—å
                </button>` :
                ''
              }
            </div>
          </td>
        </tr>
      `).join('');

      updatePagination(sortedEmployees.length);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –±–µ–π–¥–∂–∞ —Ä–æ–ª–∏
    function getRoleBadgeClass(role) {
      const classes = {
        'Admin': 'status-badge--danger',
        'Manager': 'status-badge--warning',
        'Employee': 'status-badge--active',
        'Customer': 'status-badge--pending'
      };
      return classes[role] || 'status-badge--pending';
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
    function updatePagination(totalItems) {
      document.getElementById('totalItems').textContent = totalItems;
      
      const startIndex = Math.min((currentPage - 1) * itemsPerPage + 1, totalItems);
      const endIndex = Math.min(currentPage * itemsPerPage, totalItems);
      document.getElementById('itemsShown').textContent = totalItems > 0 ? `${startIndex}-${endIndex}` : '0';

      const totalPages = Math.ceil(totalItems / itemsPerPage);
      const prevButton = document.getElementById('prevButton');
      const nextButton = document.getElementById('nextButton');
      
      prevButton.disabled = currentPage <= 1;
      nextButton.disabled = currentPage >= totalPages;

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
      const pageNumbers = document.getElementById('pageNumbers');
      pageNumbers.innerHTML = '';
      
      for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
        const button = document.createElement('button');
        button.className = `pagination__button ${i === currentPage ? 'pagination__button--active' : ''}`;
        button.textContent = i;
        button.onclick = () => goToPage(i);
        pageNumbers.appendChild(button);
      }
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    function goToPage(page) {
      const totalPages = Math.ceil(filteredEmployees.length / itemsPerPage);
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        renderEmployees();
      }
    }

    // –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU');
    }

    function formatPhone(phone) {
      // –ü—Ä–æ—Å—Ç–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      return phone || '–ù–µ —É–∫–∞–∑–∞–Ω';
    }

    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    function showNewEmployeeModal() {
      if (currentUser.role !== 'Admin') return;
      document.getElementById('newEmployeeModal').classList.add('modal-overlay--open');
    }

    function hideNewEmployeeModal() {
      document.getElementById('newEmployeeModal').classList.remove('modal-overlay--open');
      document.getElementById('newEmployeeForm').reset();
      clearErrors();
    }

    function showEditEmployeeModal(employeeId) {
      const employee = employees.find(e => e.id === employeeId);
      if (!employee) return;

      document.getElementById('editEmployeeId').value = employee.id;
      document.getElementById('editFirstName').value = employee.firstName;
      document.getElementById('editLastName').value = employee.lastName;
      document.getElementById('editEmail').value = employee.email;
      document.getElementById('editPhone').value = employee.phone;
      document.getElementById('editDateBirth').value = employee.dateBirth;
      document.getElementById('editRole').value = employee.role;
      document.getElementById('editCompanyId').value = employee.companyId;
      document.getElementById('editTelegramId').value = employee.telegramId || '';

      document.getElementById('editEmployeeModal').classList.add('modal-overlay--open');
    }

    function hideEditEmployeeModal() {
      document.getElementById('editEmployeeModal').classList.remove('modal-overlay--open');
      document.getElementById('editEmployeeForm').reset();
    }

    // –û—á–∏—Å—Ç–∫–∞ –æ—à–∏–±–æ–∫
    function clearErrors() {
      const emailError = document.getElementById('emailError');
      if (emailError) {
        emailError.style.display = 'none';
      }
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function createEmployee() {
      const form = document.getElementById('newEmployeeForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const formData = new FormData(form);
      const email = document.getElementById('email').value;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email
      if (employees.find(e => e.email === email)) {
        const emailError = document.getElementById('emailError');
        emailError.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
        emailError.style.display = 'block';
        return;
      }

      const createButton = document.getElementById('createEmployeeButton');
      const createButtonText = document.getElementById('createButtonText');
      
      createButton.disabled = true;
      createButtonText.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ...';

      // –ò–º–∏—Ç–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–∞
      setTimeout(() => {
        const company = demoCompanies.find(c => c.id === document.getElementById('companyId').value);
        
        const newEmployee = {
          id: Date.now().toString(),
          email: document.getElementById('email').value,
          firstName: document.getElementById('firstName').value,
          lastName: document.getElementById('lastName').value,
          phone: document.getElementById('phone').value,
          dateBirth: document.getElementById('dateBirth').value,
          role: document.getElementById('role').value,
          companyId: document.getElementById('companyId').value,
          companyName: company ? company.name : '',
          telegramId: document.getElementById('telegramId').value || null,
          createdAt: new Date().toISOString().split('T')[0]
        };

        employees.push(newEmployee);
        applyFilters();
        updateStatistics();
        hideNewEmployeeModal();
        
        createButton.disabled = false;
        createButtonText.textContent = '–°–æ–∑–¥–∞—Ç—å';
      }, 1000);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function updateEmployee() {
      const form = document.getElementById('editEmployeeForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const employeeId = document.getElementById('editEmployeeId').value;
      const employee = employees.find(e => e.id === employeeId);
      if (!employee) return;

      const company = demoCompanies.find(c => c.id === document.getElementById('editCompanyId').value);

      employee.firstName = document.getElementById('editFirstName').value;
      employee.lastName = document.getElementById('editLastName').value;
      employee.email = document.getElementById('editEmail').value;
      employee.phone = document.getElementById('editPhone').value;
      employee.dateBirth = document.getElementById('editDateBirth').value;
      employee.role = document.getElementById('editRole').value;
      employee.companyId = document.getElementById('editCompanyId').value;
      employee.companyName = company ? company.name : '';
      employee.telegramId = document.getElementById('editTelegramId').value || null;

      applyFilters();
      updateStatistics();
      hideEditEmployeeModal();
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    function deleteEmployee(employeeId) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) return;
      
      employees = employees.filter(e => e.id !== employeeId);
      applyFilters();
      updateStatistics();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      loadData();
    });

    // –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫
    document.getElementById('roleFilter').addEventListener('change', applyFilters);
    document.getElementById('companyFilter').addEventListener('change', applyFilters);
    document.getElementById('searchInput').addEventListener('input', applyFilters);

    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    document.querySelectorAll('.table__header--sortable').forEach(header => {
      header.addEventListener('click', () => {
        const newSortBy = header.getAttribute('data-sort');
        
        if (sortBy === newSortBy) {
          sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
        } else {
          sortBy = newSortBy;
          sortOrder = 'asc';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
        document.querySelectorAll('.table__header--sortable').forEach(h => {
          h.classList.remove('table__header--sorted-asc', 'table__header--sorted-desc');
        });
        
        header.classList.add(`table__header--sorted-${sortOrder}`);
        
        renderEmployees();
      });
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('modal-overlay--open');
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay--open').forEach(modal => {
          modal.classList.remove('modal-overlay--open');
        });
      }
    });
  </script>
</body>
</html>