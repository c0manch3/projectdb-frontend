<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - LenconDB</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="projects.html" class="header__logo">LenconDB</a>
    
    <nav class="header__nav">
      <a href="projects.html" class="header__nav-link">–ü—Ä–æ–µ–∫—Ç—ã</a>
      <a href="employees.html" class="header__nav-link" id="employeesNav">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
      <a href="companies.html" class="header__nav-link">–ö–æ–º–ø–∞–Ω–∏–∏</a>
      <a href="workload.html" class="header__nav-link">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</a>
    </nav>
    
    <div class="header__user">
      <div class="header__user-info">
        <div class="header__user-name" id="userName">–ì–æ—Å—Ç—å</div>
        <div class="header__user-role" id="userRole">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</div>
      </div>
      <div class="header__user-avatar" id="userAvatar">?</div>
      <button class="button button--secondary button--small" onclick="goToLogin()">–í–æ–π—Ç–∏</button>
    </div>
  </header>

  <!-- 404 Content -->
  <main class="main">
    <div class="not-found">
      <div class="not-found__container">
        <div class="not-found__code">404</div>
        <h1 class="not-found__title">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h1>
        <p class="not-found__message">
          –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è –µ–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
          –í–æ–∑–º–æ–∂–Ω–æ, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∞.
        </p>
        
        <!-- Useful Links -->
        <div class="not-found__links">
          <h3 class="not-found__links-title">–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</h3>
          <div class="not-found__buttons">
            <a href="projects.html" class="button button--primary">–ü—Ä–æ–µ–∫—Ç—ã</a>
            <a href="companies.html" class="button button--secondary">–ö–æ–º–ø–∞–Ω–∏–∏</a>
            <a href="workload.html" class="button button--secondary">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</a>
            <a href="user-profile.html" class="button button--secondary">–ü—Ä–æ—Ñ–∏–ª—å</a>
          </div>
        </div>
        
        <!-- Search -->
        <div style="margin-bottom: 2rem;">
          <div class="search-input" style="max-width: 400px; margin: 0 auto;">
            <input 
              type="text" 
              id="searchInput" 
              class="form__input search-input__field" 
              placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É..."
              onkeypress="handleSearch(event)"
            >
            <span class="search-input__icon">üîç</span>
          </div>
        </div>

        <a href="projects.html" class="button button--primary button--large">
          –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        </a>
      </div>
    </div>
  </main>

  <!-- Error Details (for developers) -->
  <div id="errorDetails" style="display: none; position: fixed; bottom: 20px; left: 20px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--border-radius); padding: 1rem; font-size: 0.875rem; color: var(--text-secondary); max-width: 400px;">
    <div style="font-weight: 600; margin-bottom: 0.5rem;">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:</div>
    <div>URL: <span id="currentUrl"></span></div>
    <div>Referrer: <span id="referrerUrl"></span></div>
    <div>User Agent: <span id="userAgent"></span></div>
    <div>–í—Ä–µ–º—è: <span id="errorTime"></span></div>
  </div>

  <script>
    let currentUser = null;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    function checkAuthAndLoadUser() {
      const user = localStorage.getItem('user');
      const accessToken = localStorage.getItem('accessToken');
      
      if (user && accessToken) {
        currentUser = JSON.parse(user);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ header
        document.getElementById('userName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
        document.getElementById('userRole').textContent = getRoleText(currentUser.role);
        document.getElementById('userAvatar').textContent = `${currentUser.firstName[0]}${currentUser.lastName[0]}`;
        
        // –ò–∑–º–µ–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤—Ö–æ–¥–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ã—Ö–æ–¥–∞
        const loginButton = document.querySelector('.header__user button');
        loginButton.textContent = '–í—ã–π—Ç–∏';
        loginButton.onclick = logout;
        
        updateUIForRole();
      }
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–æ–ª–∏
    function getRoleText(role) {
      const roles = {
        'Admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
        'Manager': '–ú–µ–Ω–µ–¥–∂–µ—Ä', 
        'Employee': '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
        'Customer': '–ó–∞–∫–∞–∑—á–∏–∫'
      };
      return roles[role] || role;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    function updateUIForRole() {
      if (!currentUser) return;
      
      const employeesNav = document.getElementById('employeesNav');
      
      if (currentUser.role === 'Employee') {
        employeesNav.style.display = 'none';
      }
    }

    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    function logout() {
      localStorage.removeItem('user');
      localStorage.removeItem('accessToken');
      localStorage.removeItem('refreshToken');
      window.location.href = 'login.html';
    }

    // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
    function goToLogin() {
      window.location.href = 'login.html';
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∏—Å–∫–∞
    function handleSearch(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim().toLowerCase();
        
        if (!query) return;
        
        // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        const searchMappings = {
          '–ø—Ä–æ–µ–∫—Ç': 'projects.html',
          '–ø—Ä–æ–µ–∫—Ç—ã': 'projects.html',
          '—Å–æ—Ç—Ä—É–¥–Ω–∏–∫': 'employees.html', 
          '—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏': 'employees.html',
          '–∫–æ–º–ø–∞–Ω–∏': 'companies.html',
          '–∑–∞–∫–∞–∑—á–∏–∫': 'companies.html',
          '–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å': 'workload.html',
          '–≤—Ä–µ–º—è': 'workload.html',
          '–ø–ª–∞–Ω': 'workload.html',
          '—Ñ–∞–∫—Ç': 'workload.html',
          '–ø—Ä–æ—Ñ–∏–ª—å': 'user-profile.html',
          '–Ω–∞—Å—Ç—Ä–æ–π–∫–∏': 'user-profile.html',
          '–ø–∞—Ä–æ–ª—å': 'user-profile.html',
          '–≤—Ö–æ–¥': 'login.html',
          '–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è': 'login.html'
        };
        
        // –ü–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
        for (const [keyword, url] of Object.entries(searchMappings)) {
          if (query.includes(keyword)) {
            window.location.href = url;
            return;
          }
        }
        
        // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        showSearchNotification('–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞.');
      }
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–∏—Å–∫–µ
    function showSearchNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--warning);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        z-index: 10000;
        animation: fadeIn 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease forwards';
        setTimeout(() => {
          if (document.body.contains(notification)) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –æ—à–∏–±–∫–∏
    function getUrlParameters() {
      const urlParams = new URLSearchParams(window.location.search);
      return {
        error: urlParams.get('error'),
        code: urlParams.get('code'),
        message: urlParams.get('message')
      };
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–æ—Å—å –±—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
    function logError() {
      const errorData = {
        url: window.location.href,
        referrer: document.referrer || 'Direct',
        userAgent: navigator.userAgent,
        timestamp: new Date().toISOString(),
        user: currentUser ? currentUser.email : 'Anonymous',
        ...getUrlParameters()
      };
      
      // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
      console.error('404 Error logged:', errorData);
      
      // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
      document.getElementById('currentUrl').textContent = errorData.url;
      document.getElementById('referrerUrl').textContent = errorData.referrer;
      document.getElementById('userAgent').textContent = errorData.userAgent.substring(0, 50) + '...';
      document.getElementById('errorTime').textContent = new Date(errorData.timestamp).toLocaleString('ru-RU');
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    document.addEventListener('keydown', (event) => {
      // Escape - –æ—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫
      if (event.key === 'Escape') {
        document.getElementById('searchInput').value = '';
      }
      
      // Ctrl/Cmd + H - –¥–æ–º–æ–π
      if ((event.ctrlKey || event.metaKey) && event.key === 'h') {
        event.preventDefault();
        window.location.href = 'projects.html';
      }
      
      // Ctrl/Cmd + L - –ª–æ–≥–∏–Ω
      if ((event.ctrlKey || event.metaKey) && event.key === 'l') {
        event.preventDefault();
        if (currentUser) {
          logout();
        } else {
          goToLogin();
        }
      }
      
      // F1 - –ø–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)
      if (event.key === 'F1') {
        event.preventDefault();
        const errorDetails = document.getElementById('errorDetails');
        errorDetails.style.display = errorDetails.style.display === 'none' ? 'block' : 'none';
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
      checkAuthAndLoadUser();
      logError();
      
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
      setTimeout(() => {
        document.getElementById('searchInput').focus();
      }, 500);
    });

    // CSS –∞–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
      }
      @keyframes fadeOut {
        from { opacity: 1; transform: translateX(-50%) translateY(0); }
        to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      }
      
      /* 404 Page Specific Styles */
      .not-found__links {
        margin: 2rem 0;
      }
      
      .not-found__links-title {
        font-size: 1.125rem;
        margin-bottom: 1.5rem;
        color: var(--text-primary);
        font-weight: 600;
        text-align: center;
      }
      
      .not-found__buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 2rem;
      }
      
      .not-found__buttons .button {
        min-width: 120px;
        text-decoration: none;
      }
      
      .not-found__buttons .button:hover {
        text-decoration: none;
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }
      
      /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ */
      .not-found__container {
        animation: slideUp 0.6s ease-out;
      }
      
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Hover —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è search input */
      .search-input:hover .search-input__field {
        border-color: var(--primary);
      }
      
      /* Responsive —É–ª—É—á—à–µ–Ω–∏—è */
      @media (max-width: 768px) {
        .not-found__container {
          padding: 1.5rem;
        }
        
        .not-found__code {
          font-size: 6rem;
        }
        
        .not-found__title {
          font-size: 1.5rem;
        }
        
        .not-found__buttons {
          flex-direction: column;
          align-items: center;
        }
        
        .not-found__buttons .button {
          min-width: 200px;
          justify-content: center;
        }
        
        #errorDetails {
          left: 10px;
          right: 10px;
          max-width: none;
        }
      }
      
      /* Accessibility —É–ª—É—á—à–µ–Ω–∏—è */
      .button:focus {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }
      
      .form__input:focus {
        outline: 2px solid var(--primary);
        outline-offset: 2px;
      }
    `;
    document.head.appendChild(style);

    // –ü–∞—Å—Ö–∞–ª—å–Ω–æ–µ —è–π—Ü–æ - –∫–æ–Ω–∞–º–∏ –∫–æ–¥
    let konamiCode = [];
    const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
    
    document.addEventListener('keydown', (event) => {
      konamiCode.push(event.code);
      
      if (konamiCode.length > konamiSequence.length) {
        konamiCode.shift();
      }
      
      if (konamiCode.join('') === konamiSequence.join('')) {
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–∞—Å—Ö–∞–ª—å–Ω–æ–≥–æ —è–π—Ü–∞
        document.body.style.transform = 'rotate(360deg)';
        document.body.style.transition = 'transform 2s ease';
        
        setTimeout(() => {
          document.body.style.transform = '';
          showSearchNotification('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ –ø–∞—Å—Ö–∞–ª—å–Ω–æ–µ —è–π—Ü–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ LenconDB!');
        }, 2000);
        
        konamiCode = [];
      }
    });
  </script>
</body>
</html>