<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ–º–ø–∞–Ω–∏–∏ - LenconDB</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="projects.html" class="header__logo">LenconDB</a>
    
    <nav class="header__nav">
      <a href="projects.html" class="header__nav-link">–ü—Ä–æ–µ–∫—Ç—ã</a>
      <a href="employees.html" class="header__nav-link" id="employeesNav">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
      <a href="companies.html" class="header__nav-link header__nav-link--active">–ö–æ–º–ø–∞–Ω–∏–∏</a>
      <a href="workload.html" class="header__nav-link">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å</a>
    </nav>
    
    <div class="header__user">
      <div class="header__user-info">
        <div class="header__user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div class="header__user-role" id="userRole">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <div class="header__user-avatar" id="userAvatar">?</div>
      <button class="button button--secondary button--small" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="page-header">
      <div class="container">
        <h1 class="page-header__title">–ö–æ–º–ø–∞–Ω–∏–∏</h1>
        <p class="page-header__subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏-–∑–∞–∫–∞–∑—á–∏–∫–∞–º–∏ –∏ –ø–æ–¥—Ä—è–¥—á–∏–∫–∞–º–∏</p>
      </div>
    </div>

    <div class="container">
      <!-- Search and Actions -->
      <div class="card">
        <div class="filters">
          <div class="search-input">
            <input 
              type="text" 
              id="searchInput" 
              class="form__input search-input__field" 
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–æ–º–ø–∞–Ω–∏–∏..."
            >
            <span class="search-input__icon">üîç</span>
          </div>

          <button class="button button--primary" id="newCompanyButton" onclick="showNewCompanyModal()">
            + –ù–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;" id="totalCompanies">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–í—Å–µ–≥–æ –∫–æ–º–ø–∞–Ω–∏–π</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--success); margin-bottom: 0.5rem;" id="activeProjects">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--warning); margin-bottom: 0.5rem;" id="customersCount">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ó–∞–∫–∞–∑—á–∏–∫–æ–≤</div>
          </div>
        </div>
        <div class="card">
          <div class="card__content text-center">
            <div style="font-size: 2rem; font-weight: 700; color: var(--secondary); margin-bottom: 0.5rem;" id="contractorsCount">0</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ü–æ–¥—Ä—è–¥—á–∏–∫–æ–≤</div>
          </div>
        </div>
      </div>

      <!-- Companies Grid -->
      <div id="companiesGrid" class="project-grid">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–ø–∞–Ω–∏–π –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
      </div>

      <!-- Loading State -->
      <div id="loadingState" class="text-center" style="padding: 2rem;">
        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π...</p>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="text-center" style="padding: 2rem; display: none;">
        <p>–ö–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        <button class="button button--primary" onclick="showNewCompanyModal()">–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</button>
      </div>
    </div>
  </main>

  <!-- New Company Modal -->
  <div class="modal-overlay" id="newCompanyModal">
    <div class="modal">
      <div class="modal__header">
        <h3 class="modal__title">–ù–æ–≤–∞—è –∫–æ–º–ø–∞–Ω–∏—è</h3>
        <button class="modal__close" onclick="hideNewCompanyModal()">√ó</button>
      </div>
      <div class="modal__content">
        <form class="form" id="newCompanyForm">
          <div class="form__group">
            <label for="companyName" class="form__label form__label--required">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
            <input 
              type="text" 
              id="companyName" 
              class="form__input" 
              placeholder='–û–û–û "–°—Ç—Ä–æ–π–ö–æ–º–ø–∞–Ω–∏—è"' 
              required
            >
          </div>
          
          <div class="form__group">
            <label for="companyType" class="form__label form__label--required">–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏</label>
            <select id="companyType" class="form__select" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
              <option value="customer">–ó–∞–∫–∞–∑—á–∏–∫</option>
              <option value="contractor">–ü–æ–¥—Ä—è–¥—á–∏–∫</option>
              <option value="partner">–ü–∞—Ä—Ç–Ω–µ—Ä</option>
            </select>
          </div>
          
          <div class="form__group">
            <label for="inn" class="form__label">–ò–ù–ù</label>
            <input 
              type="text" 
              id="inn" 
              class="form__input" 
              placeholder="1234567890" 
              maxlength="12"
              pattern="[0-9]{10,12}"
            >
            <div class="form__help">10 —Ü–∏—Ñ—Ä –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, 12 –¥–ª—è –ò–ü</div>
          </div>
          
          <div class="form__group">
            <label for="kpp" class="form__label">–ö–ü–ü</label>
            <input 
              type="text" 
              id="kpp" 
              class="form__input" 
              placeholder="123456789" 
              maxlength="9"
              pattern="[0-9]{9}"
            >
          </div>
          
          <div class="form__group">
            <label for="address" class="form__label">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
            <textarea 
              id="address" 
              class="form__textarea" 
              placeholder="–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 1, –æ—Ñ. 100"
            ></textarea>
          </div>
          
          <div class="form__group">
            <label for="phone" class="form__label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input 
              type="tel" 
              id="phone" 
              class="form__input" 
              placeholder="+7 (812) 123-45-67"
            >
          </div>
          
          <div class="form__group">
            <label for="email" class="form__label">Email</label>
            <input 
              type="email" 
              id="email" 
              class="form__input" 
              placeholder="info@company.com"
            >
          </div>
          
          <div class="form__group">
            <label for="website" class="form__label">–°–∞–π—Ç</label>
            <input 
              type="url" 
              id="website" 
              class="form__input" 
              placeholder="https://company.com"
            >
          </div>
          
          <div class="form__group">
            <label for="description" class="form__label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea 
              id="description" 
              class="form__textarea" 
              placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–º–ø–∞–Ω–∏–∏"
            ></textarea>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="button button--secondary" onclick="hideNewCompanyModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="button button--primary" id="createCompanyButton" onclick="createCompany()">
          <span id="createButtonText">–°–æ–∑–¥–∞—Ç—å</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Company Details Modal -->
  <div class="modal-overlay" id="companyDetailsModal">
    <div class="modal">
      <div class="modal__header">
        <h3 class="modal__title" id="detailsModalTitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏–∏</h3>
        <button class="modal__close" onclick="hideCompanyDetailsModal()">√ó</button>
      </div>
      <div class="modal__content">
        <div id="companyDetailsContent">
          <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
      </div>
      <div class="modal__footer">
        <button class="button button--secondary" onclick="hideCompanyDetailsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
        <button class="button button--primary" id="editCompanyButton" onclick="editCurrentCompany()">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Company Modal -->
  <div class="modal-overlay" id="editCompanyModal">
    <div class="modal">
      <div class="modal__header">
        <h3 class="modal__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</h3>
        <button class="modal__close" onclick="hideEditCompanyModal()">√ó</button>
      </div>
      <div class="modal__content">
        <form class="form" id="editCompanyForm">
          <input type="hidden" id="editCompanyId">
          
          <div class="form__group">
            <label for="editCompanyName" class="form__label form__label--required">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
            <input type="text" id="editCompanyName" class="form__input" required>
          </div>
          
          <div class="form__group">
            <label for="editCompanyType" class="form__label form__label--required">–¢–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏</label>
            <select id="editCompanyType" class="form__select" required>
              <option value="customer">–ó–∞–∫–∞–∑—á–∏–∫</option>
              <option value="contractor">–ü–æ–¥—Ä—è–¥—á–∏–∫</option>
              <option value="partner">–ü–∞—Ä—Ç–Ω–µ—Ä</option>
            </select>
          </div>
          
          <div class="form__group">
            <label for="editInn" class="form__label">–ò–ù–ù</label>
            <input type="text" id="editInn" class="form__input" maxlength="12" pattern="[0-9]{10,12}">
          </div>
          
          <div class="form__group">
            <label for="editKpp" class="form__label">–ö–ü–ü</label>
            <input type="text" id="editKpp" class="form__input" maxlength="9" pattern="[0-9]{9}">
          </div>
          
          <div class="form__group">
            <label for="editAddress" class="form__label">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</label>
            <textarea id="editAddress" class="form__textarea"></textarea>
          </div>
          
          <div class="form__group">
            <label for="editPhone" class="form__label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" id="editPhone" class="form__input">
          </div>
          
          <div class="form__group">
            <label for="editEmail" class="form__label">Email</label>
            <input type="email" id="editEmail" class="form__input">
          </div>
          
          <div class="form__group">
            <label for="editWebsite" class="form__label">–°–∞–π—Ç</label>
            <input type="url" id="editWebsite" class="form__input">
          </div>
          
          <div class="form__group">
            <label for="editDescription" class="form__label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="editDescription" class="form__textarea"></textarea>
          </div>
        </form>
      </div>
      <div class="modal__footer">
        <button class="button button--secondary" onclick="hideEditCompanyModal()">–û—Ç–º–µ–Ω–∞</button>
        <button class="button button--primary" onclick="updateCompany()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let currentUser = null;
    let companies = [];
    let filteredCompanies = [];
    let currentCompany = null;

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function checkAuth() {
      const user = localStorage.getItem('user');
      const accessToken = localStorage.getItem('accessToken');
      
      if (!user || !accessToken) {
        window.location.href = 'login.html';
        return;
      }
      
      currentUser = JSON.parse(user);
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
      document.getElementById('userName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
      document.getElementById('userRole').textContent = getRoleText(currentUser.role);
      document.getElementById('userAvatar').textContent = `${currentUser.firstName[0]}${currentUser.lastName[0]}`;
      
      updateUIForRole();
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ä–æ–ª–∏
    function getRoleText(role) {
      const roles = {
        'Admin': '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
        'Manager': '–ú–µ–Ω–µ–¥–∂–µ—Ä',
        'Employee': '–°–æ—Ç—Ä—É–¥–Ω–∏–∫',
        'Customer': '–ó–∞–∫–∞–∑—á–∏–∫'
      };
      return roles[role] || role;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
    function updateUIForRole() {
      const newCompanyButton = document.getElementById('newCompanyButton');
      const employeesNav = document.getElementById('employeesNav');
      
      if (currentUser.role === 'Employee') {
        newCompanyButton.style.display = 'none';
        employeesNav.style.display = 'none';
      } else if (currentUser.role === 'Manager') {
        newCompanyButton.style.display = 'none';
      }
    }

    // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
    function logout() {
      localStorage.removeItem('user');
      localStorage.removeItem('accessToken');
      localStorage.removeItem('refreshToken');
      window.location.href = 'login.html';
    }

    // –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    const demoCompanies = [
      {
        id: '1',
        name: '–û–û–û "–°—Ç—Ä–æ–π–ò–Ω–≤–µ—Å—Ç"',
        type: 'customer',
        inn: '7812345678',
        kpp: '781234567',
        address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –°—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–∞—è, –¥. 15, –æ—Ñ. 200',
        phone: '+7 (812) 123-45-67',
        email: 'info@stroyinvest.ru',
        website: 'https://stroyinvest.ru',
        description: '–ö—Ä—É–ø–Ω–∞—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω–æ-–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∞—è—Å—è –Ω–∞ –∂–∏–ª–∏—â–Ω–æ–º —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–µ',
        projectsCount: 3,
        activeProjectsCount: 2,
        createdAt: '2024-01-01'
      },
      {
        id: '2',
        name: '–ê–û "–¢–æ—Ä–≥–æ–≤—ã–µ —Ü–µ–Ω—Ç—Ä—ã"',
        type: 'customer',
        inn: '7823456789',
        kpp: '782345678',
        address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ø—Ä. –ù–µ–≤—Å–∫–∏–π, –¥. 100',
        phone: '+7 (812) 234-56-78',
        email: 'orders@shopping-centers.ru',
        website: 'https://shopping-centers.ru',
        description: '–î–µ–≤–µ–ª–æ–ø–µ—Ä —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ü–µ–Ω—Ç—Ä–æ–≤ –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏',
        projectsCount: 2,
        activeProjectsCount: 1,
        createdAt: '2024-01-15'
      },
      {
        id: '3',
        name: '–ó–ê–û "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –ü–ª—é—Å"',
        type: 'customer',
        inn: '7834567890',
        kpp: '783456789',
        address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –û—Ñ–∏—Å–Ω–∞—è, –¥. 50',
        phone: '+7 (812) 345-67-89',
        email: 'contact@realty-plus.ru',
        website: 'https://realty-plus.ru',
        description: '–û—Ñ–∏—Å–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ –±–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä—ã',
        projectsCount: 1,
        activeProjectsCount: 0,
        createdAt: '2023-12-01'
      },
      {
        id: '4',
        name: '–õ–µ–Ω–∫–æ–Ω–ë—é—Ä–æ',
        type: 'contractor',
        inn: '7845678901',
        kpp: '784567890',
        address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ü—Ä–æ–µ–∫—Ç–Ω–∞—è, –¥. 25, –æ—Ñ. 301',
        phone: '+7 (812) 456-78-90',
        email: 'office@lenconburo.ru',
        website: 'https://lenconburo.ru',
        description: '–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–æ–µ –±—é—Ä–æ –ø–æ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π',
        projectsCount: 6,
        activeProjectsCount: 3,
        createdAt: '2023-11-01'
      },
      {
        id: '5',
        name: '–û–û–û "–ò–Ω–∂–ì–µ–æ–°—Ç—Ä–æ–π"',
        type: 'partner',
        inn: '7856789012',
        kpp: '785678901',
        address: '–≥. –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, —É–ª. –ì–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è, –¥. 8',
        phone: '+7 (812) 567-89-01',
        email: 'geo@inzhgeo.ru',
        website: 'https://inzhgeo.ru',
        description: '–ò–Ω–∂–µ–Ω–µ—Ä–Ω–æ-–≥–µ–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–∑—ã—Å–∫–∞–Ω–∏—è',
        projectsCount: 4,
        activeProjectsCount: 2,
        createdAt: '2024-02-01'
      }
    ];

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    function loadData() {
      companies = demoCompanies;
      applyFilters();
      updateStatistics();
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    function updateStatistics() {
      document.getElementById('totalCompanies').textContent = companies.length;
      
      const totalActiveProjects = companies.reduce((sum, company) => sum + (company.activeProjectsCount || 0), 0);
      document.getElementById('activeProjects').textContent = totalActiveProjects;
      
      document.getElementById('customersCount').textContent = companies.filter(c => c.type === 'customer').length;
      document.getElementById('contractorsCount').textContent = companies.filter(c => c.type === 'contractor').length;
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
    function applyFilters() {
      const searchQuery = document.getElementById('searchInput').value.toLowerCase();

      filteredCompanies = companies.filter(company => {
        // –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
        if (searchQuery && !company.name.toLowerCase().includes(searchQuery)) return false;
        
        return true;
      });

      renderCompanies();
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–º–ø–∞–Ω–∏–π
    function renderCompanies() {
      const grid = document.getElementById('companiesGrid');
      const loadingState = document.getElementById('loadingState');
      const emptyState = document.getElementById('emptyState');
      
      loadingState.style.display = 'none';
      
      if (filteredCompanies.length === 0) {
        grid.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }
      
      emptyState.style.display = 'none';
      
      grid.innerHTML = filteredCompanies.map(company => `
        <div class="project-card" onclick="showCompanyDetails('${company.id}')">
          <div class="project-card__header">
            <div>
              <div class="project-card__title">${company.name}</div>
              <div class="project-card__customer">${getCompanyTypeText(company.type)}</div>
            </div>
            <span class="status-badge ${getCompanyTypeBadgeClass(company.type)}">
              ${getCompanyTypeText(company.type)}
            </span>
          </div>
          
          <div class="project-card__info">
            <div class="project-card__info-item">
              <div class="project-card__info-label">–ü—Ä–æ–µ–∫—Ç—ã</div>
              <div class="project-card__info-value">${company.projectsCount || 0}</div>
            </div>
            <div class="project-card__info-item">
              <div class="project-card__info-label">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
              <div class="project-card__info-value">${company.activeProjectsCount || 0}</div>
            </div>
            <div class="project-card__info-item">
              <div class="project-card__info-label">–ò–ù–ù</div>
              <div class="project-card__info-value">${company.inn || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
            </div>
            <div class="project-card__info-item">
              <div class="project-card__info-label">–¢–µ–ª–µ—Ñ–æ–Ω</div>
              <div class="project-card__info-value">${formatPhone(company.phone)}</div>
            </div>
          </div>
          
          <div class="project-card__footer">
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
              –°–æ–∑–¥–∞–Ω–∞: ${formatDate(company.createdAt)}
            </div>
            
            <div style="display: flex; gap: 0.5rem;">
              <button class="button button--small button--secondary" onclick="event.stopPropagation(); showCompanyDetails('${company.id}')">
                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
              </button>
              ${currentUser.role === 'Admin' ?
                `<button class="button button--small button--danger" onclick="event.stopPropagation(); deleteCompany('${company.id}')">
                  –£–¥–∞–ª–∏—Ç—å
                </button>` :
                ''
              }
            </div>
          </div>
        </div>
      `).join('');
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Ç–∏–ø–∞ –∫–æ–º–ø–∞–Ω–∏–∏
    function getCompanyTypeText(type) {
      const types = {
        'customer': '–ó–∞–∫–∞–∑—á–∏–∫',
        'contractor': '–ü–æ–¥—Ä—è–¥—á–∏–∫',
        'partner': '–ü–∞—Ä—Ç–Ω–µ—Ä'
      };
      return types[type] || type;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –±–µ–π–¥–∂–∞ —Ç–∏–ø–∞ –∫–æ–º–ø–∞–Ω–∏–∏
    function getCompanyTypeBadgeClass(type) {
      const classes = {
        'customer': 'status-badge--active',
        'contractor': 'status-badge--warning',
        'partner': 'status-badge--pending'
      };
      return classes[type] || 'status-badge--pending';
    }

    // –£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU');
    }

    function formatPhone(phone) {
      return phone || '–ù–µ —É–∫–∞–∑–∞–Ω';
    }

    // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
    function showNewCompanyModal() {
      if (currentUser.role !== 'Admin') return;
      document.getElementById('newCompanyModal').classList.add('modal-overlay--open');
    }

    function hideNewCompanyModal() {
      document.getElementById('newCompanyModal').classList.remove('modal-overlay--open');
      document.getElementById('newCompanyForm').reset();
    }

    function showCompanyDetails(companyId) {
      const company = companies.find(c => c.id === companyId);
      if (!company) return;

      currentCompany = company;
      document.getElementById('detailsModalTitle').textContent = company.name;
      
      const content = document.getElementById('companyDetailsContent');
      content.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">–¢–∏–ø</div>
            <div style="font-weight: 500;">${getCompanyTypeText(company.type)}</div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">–ò–ù–ù</div>
            <div style="font-weight: 500; font-family: var(--font-mono);">${company.inn || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">–ö–ü–ü</div>
            <div style="font-weight: 500; font-family: var(--font-mono);">${company.kpp || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">–¢–µ–ª–µ—Ñ–æ–Ω</div>
            <div style="font-weight: 500;">${company.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Email</div>
            <div style="font-weight: 500;">${company.email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
          </div>
          <div>
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.25rem;">–°–∞–π—Ç</div>
            <div style="font-weight: 500;">
              ${company.website ? `<a href="${company.website}" target="_blank">${company.website}</a>` : '–ù–µ —É–∫–∞–∑–∞–Ω'}
            </div>
          </div>
        </div>
        
        ${company.address ? `
          <div style="margin-top: 1.5rem;">
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å</div>
            <div style="padding: 1rem; background: var(--surface); border-radius: var(--border-radius);">
              ${company.address}
            </div>
          </div>
        ` : ''}
        
        ${company.description ? `
          <div style="margin-top: 1.5rem;">
            <div style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: 0.5rem;">–û–ø–∏—Å–∞–Ω–∏–µ</div>
            <div style="padding: 1rem; background: var(--surface); border-radius: var(--border-radius);">
              ${company.description}
            </div>
          </div>
        ` : ''}
        
        <div style="margin-top: 1.5rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
          <div class="text-center">
            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 0.25rem;">
              ${company.projectsCount || 0}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
          </div>
          <div class="text-center">
            <div style="font-size: 1.5rem; font-weight: 700; color: var(--success); margin-bottom: 0.25rem;">
              ${company.activeProjectsCount || 0}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
          </div>
          <div class="text-center">
            <div style="font-size: 1rem; font-weight: 500; color: var(--text-secondary); margin-bottom: 0.25rem;">
              ${formatDate(company.createdAt)}
            </div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</div>
          </div>
        </div>
      `;

      // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è Employee
      const editButton = document.getElementById('editCompanyButton');
      editButton.style.display = currentUser.role === 'Employee' ? 'none' : 'inline-flex';

      document.getElementById('companyDetailsModal').classList.add('modal-overlay--open');
    }

    function hideCompanyDetailsModal() {
      document.getElementById('companyDetailsModal').classList.remove('modal-overlay--open');
      currentCompany = null;
    }

    function editCurrentCompany() {
      if (!currentCompany) return;
      hideCompanyDetailsModal();
      showEditCompanyModal(currentCompany.id);
    }

    function showEditCompanyModal(companyId) {
      if (currentUser.role === 'Employee') return;
      
      const company = companies.find(c => c.id === companyId);
      if (!company) return;

      document.getElementById('editCompanyId').value = company.id;
      document.getElementById('editCompanyName').value = company.name;
      document.getElementById('editCompanyType').value = company.type;
      document.getElementById('editInn').value = company.inn || '';
      document.getElementById('editKpp').value = company.kpp || '';
      document.getElementById('editAddress').value = company.address || '';
      document.getElementById('editPhone').value = company.phone || '';
      document.getElementById('editEmail').value = company.email || '';
      document.getElementById('editWebsite').value = company.website || '';
      document.getElementById('editDescription').value = company.description || '';

      document.getElementById('editCompanyModal').classList.add('modal-overlay--open');
    }

    function hideEditCompanyModal() {
      document.getElementById('editCompanyModal').classList.remove('modal-overlay--open');
      document.getElementById('editCompanyForm').reset();
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    function createCompany() {
      const form = document.getElementById('newCompanyForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const createButton = document.getElementById('createCompanyButton');
      const createButtonText = document.getElementById('createButtonText');
      
      createButton.disabled = true;
      createButtonText.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ...';

      // –ò–º–∏—Ç–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–∞
      setTimeout(() => {
        const newCompany = {
          id: Date.now().toString(),
          name: document.getElementById('companyName').value,
          type: document.getElementById('companyType').value,
          inn: document.getElementById('inn').value || null,
          kpp: document.getElementById('kpp').value || null,
          address: document.getElementById('address').value || null,
          phone: document.getElementById('phone').value || null,
          email: document.getElementById('email').value || null,
          website: document.getElementById('website').value || null,
          description: document.getElementById('description').value || null,
          projectsCount: 0,
          activeProjectsCount: 0,
          createdAt: new Date().toISOString().split('T')[0]
        };

        companies.push(newCompany);
        applyFilters();
        updateStatistics();
        hideNewCompanyModal();
        
        createButton.disabled = false;
        createButtonText.textContent = '–°–æ–∑–¥–∞—Ç—å';
      }, 1000);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    function updateCompany() {
      const form = document.getElementById('editCompanyForm');
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const companyId = document.getElementById('editCompanyId').value;
      const company = companies.find(c => c.id === companyId);
      if (!company) return;

      company.name = document.getElementById('editCompanyName').value;
      company.type = document.getElementById('editCompanyType').value;
      company.inn = document.getElementById('editInn').value || null;
      company.kpp = document.getElementById('editKpp').value || null;
      company.address = document.getElementById('editAddress').value || null;
      company.phone = document.getElementById('editPhone').value || null;
      company.email = document.getElementById('editEmail').value || null;
      company.website = document.getElementById('editWebsite').value || null;
      company.description = document.getElementById('editDescription').value || null;

      applyFilters();
      updateStatistics();
      hideEditCompanyModal();
    }

    // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
    function deleteCompany(companyId) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é?')) return;
      
      companies = companies.filter(c => c.id !== companyId);
      applyFilters();
      updateStatistics();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    document.addEventListener('DOMContentLoaded', () => {
      checkAuth();
      loadData();
    });

    // –ü–æ–∏—Å–∫
    document.getElementById('searchInput').addEventListener('input', applyFilters);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('modal-overlay--open');
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay--open').forEach(modal => {
          modal.classList.remove('modal-overlay--open');
        });
      }
    });
  </script>
</body>
</html>